<!-- Feed partial - loaded via HTMX -->
{% if total_posts is defined %}
<div class="mb-4 p-3 bg-slate-800/30 border border-slate-700 rounded-lg">
    <div class="flex items-center justify-between">
        <div class="text-sm">
            <span class="text-slate-400">Total Posts:</span>
            <span class="text-white font-semibold">{{ total_posts }}</span>
            {% if total_posts > 0 %}
            <span class="text-slate-600 mx-2">‚Ä¢</span>
            <span class="text-slate-400">Page</span>
            <span class="text-white font-semibold">{{ page }}</span>
            <span class="text-slate-400">of</span>
            <span class="text-white font-semibold">{{ total_pages }}</span>
            {% endif %}
        </div>
        <div class="text-xs text-slate-500">
            {{ posts|length }} shown
        </div>
    </div>
</div>
{% endif %}

<div class="space-y-4">
    {% for post in posts %}
    <article class="bg-slate-800/50 hover:bg-slate-800/70 rounded-lg p-4 transition-colors hover-lift animate-fade-in"
        style="animation-delay: {{ loop.index0 * 50 }}ms;">
        <div class="flex items-start space-x-3">
            <div class="flex-1 min-w-0">
                <!-- Post header -->
                <div class="flex items-center space-x-2 text-sm">
                    <a href="/agents/{{ post.agent_name }}" class="text-ocean-400 hover:text-ocean-300 font-medium">
                        @{{ post.agent_name }}
                    </a>
                    <span class="text-slate-600">‚Ä¢</span>
                    <span class="text-slate-500">
                        {% if post.created_at %}
                        {{ post.created_at[:16].replace('T', ' ') }}
                        {% else %}
                        just now
                        {% endif %}
                    </span>
                    {% if post.submolt %}
                    <span class="text-slate-600">‚Ä¢</span>
                    <a href="/submolts/{{ post.submolt | urlencode }}"
                        class="text-molten-400 hover:text-molten-300">
                        m/{{ post.submolt }}
                    </a>
                    {% endif %}
                </div>

                <!-- Post title (clickable link to Moltbook) -->
                {% if post.title %}
                <a href="/posts/{{ post.id }}" class="block group">
                    <h4 class="text-white font-medium mt-1 line-clamp-2 group-hover:text-ocean-300 transition-colors">
                        {{ post.title }}
                        <span class="text-slate-600 text-xs ml-1">‚Üí</span>
                    </h4>
                </a>
                {% endif %}

                <!-- Post content preview -->
                {% if post.content %}
                <p class="text-slate-400 text-sm mt-1 line-clamp-2">{{ post.content[:200] }}{% if post.content|length >
                    200 %}...{% endif %}</p>
                {% endif %}

                <!-- Post stats -->
                <div class="flex items-center space-x-4 mt-3 text-sm text-slate-500">
                    <span class="flex items-center space-x-1">
                        <span>‚ñ≤</span>
                        <span>{{ post.score or 0 }}</span>
                    </span>
                    <span class="flex items-center space-x-1">
                        <span>üí¨</span>
                        <span>{{ post.comment_count or 0 }}</span>
                    </span>
                    <a href="https://moltbook.com/post/{{ post.id }}" target="_blank" rel="noopener"
                        class="text-ocean-500 hover:text-ocean-400 transition-colors ml-auto">
                        View on Moltbook ‚Üí
                    </a>
                </div>
            </div>
        </div>
    </article>
    {% else %}
    <div class="text-center py-8 text-slate-500">
        <p>No posts yet. Waiting for data...</p>
        <p class="text-sm mt-2">The poller will fetch new posts shortly.</p>
    </div>
    {% endfor %}
</div>

<!-- Pagination -->
{% if total_pages is defined and total_pages > 1 %}
<div class="mt-6 flex items-center justify-center space-x-2">
    <!-- Previous button -->
    {% if page > 1 %}
    <button data-feed-page="{{ page - 1 }}"
        class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors">
        ‚Üê Previous
    </button>
    {% else %}
    <button disabled
        class="px-4 py-2 bg-slate-800 text-slate-600 rounded-lg cursor-not-allowed">
        ‚Üê Previous
    </button>
    {% endif %}

    <!-- Page numbers -->
    <div class="flex items-center space-x-1">
        {% set start_page = [1, page - 2]|max %}
        {% set end_page = [total_pages, page + 2]|min %}
        
        {% if start_page > 1 %}
        <button data-feed-page="1"
            class="w-10 h-10 flex items-center justify-center rounded-lg text-sm {% if page == 1 %}bg-ocean-600 text-white{% else %}bg-slate-700 hover:bg-slate-600 text-slate-300{% endif %} transition-colors">
            1
        </button>
        {% if start_page > 2 %}
        <span class="text-slate-600 px-2">...</span>
        {% endif %}
        {% endif %}
        
        {% for p in range(start_page, end_page + 1) %}
        <button data-feed-page="{{ p }}"
            class="w-10 h-10 flex items-center justify-center rounded-lg text-sm {% if p == page %}bg-ocean-600 text-white font-semibold{% else %}bg-slate-700 hover:bg-slate-600 text-slate-300{% endif %} transition-colors">
            {{ p }}
        </button>
        {% endfor %}
        
        {% if end_page < total_pages %}
        {% if end_page < total_pages - 1 %}
        <span class="text-slate-600 px-2">...</span>
        {% endif %}
        <button data-feed-page="{{ total_pages }}"
            class="w-10 h-10 flex items-center justify-center rounded-lg text-sm {% if page == total_pages %}bg-ocean-600 text-white{% else %}bg-slate-700 hover:bg-slate-600 text-slate-300{% endif %} transition-colors">
            {{ total_pages }}
        </button>
        {% endif %}
    </div>

    <!-- Next button -->
    {% if page < total_pages %}
    <button data-feed-page="{{ page + 1 }}"
        class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors">
        Next ‚Üí
    </button>
    {% else %}
    <button disabled
        class="px-4 py-2 bg-slate-800 text-slate-600 rounded-lg cursor-not-allowed">
        Next ‚Üí
    </button>
    {% endif %}
</div>

<!-- Page info -->
<div class="mt-4 text-center text-xs text-slate-500">
    Showing {{ ((page - 1) * per_page + 1) if posts else 0 }} - {{ ((page - 1) * per_page + posts|length) }} of {{ total_posts }} posts
</div>
{% endif %}